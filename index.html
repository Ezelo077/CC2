const WebSocket = require('ws');
const wss = new WebSocket.Server({ port: 8080 });

let cubePositions = generateInitialPositions();

wss.on('connection', ws => {
  ws.on('message', msg => {
    const [ cmd, data ] = JSON.parse(msg);
    switch(cmd) {
      case 'request-initial-cubes':
        // nur an den Anfragenden
        ws.send(JSON.stringify(['spawn-cubes', cubePositions]));
        break;
      case 'collect-cube':
        const idx = data;
        // neue Position berechnen
        cubePositions[idx] = randomPositionNotColliding(cubePositions);
        // an ALLE broadcasten
        wss.clients.forEach(c => {
          if (c.readyState === WebSocket.OPEN) {
            c.send(JSON.stringify(['spawn-cubes', cubePositions]));
          }
        });
        break;
      // verwalte hier *enter-room* und *subscribe-client-count* etc. nach Bedarf
    }
  });
});
